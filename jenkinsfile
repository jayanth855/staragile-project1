node{
    def mavenHome
    def mavenCMD
    def docker
    def dockerCMD
    
    stage('preparation for jenkins'){
        echo 'initializing variables and tools'
        mavenHome = tool name:'maven' , type: 'maven'
        mavenCMD = "${mavenHome}/bin/mvn"
        docker = tool name: 'docker', type: 'org.jenkinsci.plugins.docker.commons.tools.DockerTool'
        dockerCMD = "${docker}/bin/docker"
        
    }
    
    
    stage('git checkout'){
    try{
        echo 'checking out code from git repository'        
        git 'https://github.com/jayanth855/staragile-project1.git'
    }
    catch(Exception e){
        echo "Exception occured in checking out the code from git repository"
        currentBuild.result="FAILURE"
        emailext body: '''Hi Team, 
        The Build has been failed. Request you to have a look and fix it asap.''', subject: 'Job ${JOB_NAME} (${BUILD_NUMBER} is failed', to: 'jayanthsureshl@gmail.com'
    }
    }
    
    
    stage('clean package'){
        //sh 'mvn clean package'
         sh "${mavenCMD} clean package"
    }
    
    
    stage('Generating test reports '){
        echo "generating test reports .execute code quality and security analysis ...."
    }
    
    
    stage('building docker image'){
        echo 'Buidling docker image from docker file ....'
        sh "${dockerCMD} build -t jayanth855/addressbook:2.0 ."
    }
    
    
    stage('Login and Push to DockerHub'){
        echo "Logging in to the DockerHub and Pushing the image"
        withCredentials([string(credentialsId: 'dockerHubPwd', variable: 'dockerHub')]) {
            sh "${dockerCMD} login -u jayanth855 -p ${dockerHub}"
            echo "pushing the image to the dockerHub..."
            sh "${dockerCMD} push jayanth855/addressbook:2.0"
        }
    }
    
    
    stage('Configure test server and deploy'){
        echo "configuring test server and deploy"
        ansiblePlaybook credentialsId: 'ansible-ssh-connection2', disableHostKeyChecking: true, installation: 'ansible', inventory: '/etc/ansible/hosts', playbook: 'configure-server.yml'
    }
    
    
    stage('execute selenium test suit'){
        echo 'executing selenium testcases'
        //command to run selenium application
    }
    
    
    stage('configure and deploy to production server'){
        echo 'deploying to production server'
        ansiblePlaybook credentialsId: 'ansible-ssh-connection2', disableHostKeyChecking: true, installation: 'ansible', inventory: '/etc/ansible/hosts', playbook: 'production-server.yml'
    }
    
    
    stage('clear workspace'){
    try{
        echo 'cleaning up the workspace'    
        cleanWs()
        //send email
    }
    catch(Exception e){                                                        
        echo "Exception occured in checking out the code from git repository"
        currentBuild.result="workspace cleared"
        emailext body: '''Hi Team, 
        The Build has been completed so workspace has been cleared.''', subject: 'Job ${JOB_NAME} (${BUILD_NUMBER} is failed', to: 'jayanthsureshl1996@gmail.com'
    }
    }
    
}
